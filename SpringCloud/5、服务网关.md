# 服务网关

## 网关

### 概述

1. 网关统一服务入口，可方便实现对平台众多服务接口进行监控
2. 对访问服务的身份认证、防报文重放与防数据篡改
3. 功能调用的服务鉴权
4. 响应数据的脱敏
5. 流量与并发控制、基于API调用的计量或计费等。

![image-20220121203310614](https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220121203310614.png)



## gateway

### 概述

> This project provides a library for building an API Gateway on top of Spring MVC. Spring Cloud Gateway aims to provide a simple, yet effective way to route to APIs and provide cross cutting concerns to them such as: security, monitoring/metrics, and resiliency.

* top of Spring MVC：Spring MVC之上
* route to APIs：路由API
* provide cross cutting concerns：提供横切关注点

### 实践

1. 创建一个springboot项目，端口为7888，注册到服务注册中心

2. 引入依赖，注意：网关服务由于在SpringMVC之上，因此不能引入springboot的web依赖（会冲突）

   ```xml
   <dependency>
       <groupId>org.springframework.cloud</groupId>
       <artifactId>spring-cloud-starter-gateway</artifactId>
   </dependency>
   ```

3. 在配置文件中配置网关，每条路由需要配id，映射到哪个地址，映射哪些路径（可多个，可写通配符）

   ```yaml
   spring:
     cloud:
       gateway:
         routes:
           - id: openfeignCliento 			# 路由对象唯一标识
             uri: http://localhost:8001/   # 服务路由地址
             predicates:   				# 断言
               - Path=/test,/demo/**
   
           - id: openfeignClientt
             uri: http://localhost:8002/
             predicates:
               - Path=/client2/**
   ```

4. java代码配置（优先级高于配置文件），模板如下

   ```java
   @Configuration
   public class GatewayConfig {
       @Bean
       public RouteLocator myLocator(RouteLocatorBuilder builder) {
           return builder.routes()
                   .route("openfeign", r -> r.path("/test")
                   .uri("http://localhost:8001"))
                   .build();
       }
   }
   ```

5. 5

6. 6

7. 7

8. 8

9. 9

